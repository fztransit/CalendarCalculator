## 程序提供的鲁历区别
鲁历A使用顾观光《六历通考》中的数据和步法，上元BC2763681。
“鲁历上元庚子至今二百七十六万一千三百三十四，算外（依法推之，当作四千三百九十四）。”
“鲁历置入蔀年减一，以章月乘之，加蔀首闰余一，以章法除之，得积月，不尽为闰余。”[^1]

鲁历B使用《中国古代历法》中的上元BC2760801。[^2]

二者推中气法相同，其推鲁僖公五年（BC655）天正冬至庚戌，小余16（分母32）。推朔法略有不同，但结果基本相同。

## 四分历推天正朔基本算法：
$ 1：上元以来蔀数\frac{入蔀年}{蔀法} = \frac{上元积年}{蔀法} $

$ 2：入蔀积月\frac{闰余}{章岁}=入蔀年 \times \frac{章月}{章岁} = \frac{入蔀年\times章月}{章岁}$

$ 3：入蔀积日\frac{小余}{蔀月}=入蔀积月 \times 朔策 = 入蔀积月 \times \frac{蔀日}{蔀月} $

$ 4：大余 ≡ 入蔀积日 (\mod 60) $

$ 5：朔干支 ≡ (蔀首干支 + 大余) (\mod 60) $

依法及《开元占经》所载古六历积年，推得周历、殷历僖五年天正冬至及朔如下（中气小余分母32，朔小余分母940）：
||周历|殷历|
|:--:|:--:|:--:|
|冬至干支（序）|辛亥（47）|壬子（48）|
|冬至小余|8|0|
|天正朔干支（序）|辛亥（47）|壬子（48）|
|天正朔小余|235|0|

## 顾观光算法
顾观光的算法是在第二步$入蔀年\times章月$后加蔀首闰余1，即：
$ 入蔀积月\frac{闰余}{章岁}=入蔀年 \times \frac{章月}{章岁} + \frac{蔀首闰余}{章岁} = \frac{入蔀年\times章月+蔀首闰余}{章岁} $

依此推得天正朔壬子，小于51。冬至庚戌在壬子前二日，顾观光认为冬至当在岁前十二月，[^3]按下表当在岁前闰十二月。

按此公式，未加蔀首闰余之前，闰余小于18之岁与加蔀首闰余之后所求入蔀积月相同，即最终所求大小余相同。只有闰余为18之岁（入章第9年），加蔀首闰余1后闰余为0。原闰余18在12以上有闰，后闰余0在12以下变为无闰。前一年则闰余11无闰变为闰余12有闰，鲁僖公五年恰为闰余19之岁，前后气朔排如下表：

|僖四年月份|朔干支|朔干支序|朔小余|中气|中气干支|气干支序|气小余|
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|正月小|戊子|24|144|冬至|乙巳|41|8|
|二月大|丁巳|53|643|大寒|乙亥|11|22|
|三月小|丁亥|23|202|雨水|丙午|42|4|
|四月大|丙辰|52|701|春分|丙子|12|18|
|五月小|丙戌|22|260|谷雨|丁未|43|0|
|六月大|乙卯|51|759|小满|丁丑|13|14|
|七月小|乙酉|21|318|夏至|丁未|43|28|
|八月大|甲寅|50|817|大暑|戊寅|14|10|
|九月小|甲申|20|376|处暑|戊申|44|24|
|十月大|癸丑|49|875|秋分|己卯|15|6|
|十一月小|癸未|19|434|霜降|己酉|45|20|
|十二月大|壬子|48|933|小雪|庚辰|16|2|
|闰十二月大|壬午|18|492|冬至|庚戌|46|16|
|僖五年月份|朔干支|朔干支序|朔小余|中气|中气干支|气干支序|气小余|
|正月小|壬子|48|51|大寒|庚辰|16|30|
|二月大|辛巳|17|550|||||
|三月小|辛亥|47|109|雨水|辛亥|47|12|
|四月大|庚辰|16|608|春分|辛巳|17|26|
|五月小|庚戌|46|167|谷雨|壬子|48|8|
|六月大|己卯|15|666|小满|壬午|18|22|
|七月小|己酉|45|225|夏至|癸丑|49|4|
|八月大|戊寅|14|724|大暑|癸未|19|18|
|九月小|戊申|44|283|处暑|甲寅|50|0|
|十月大|丁丑|13|782|秋分|甲申|20|14|
|十一月小|丁未|43|341|霜降|甲寅|50|28|
|十二月大|丙子|12|840|小雪|乙酉|21|10|

以法推僖五年天正，得正月壬子朔，中气大寒。然距僖四年十二月壬子朔中缺一月，若置闰，则为闰十二月壬午朔，中气冬至。有中气之月为闰，故其法不用无中气置闰，与《春秋》闰在岁终颇合。然此法在一章七闰中仅一闰能改置岁终，其余按闰余法唯入章第19年闰在年终，其余皆在年中，前后乖异。程序排版则按无中气法置闰，以便于与其他历法比较。若需查看闰余法闰在何月，点击“置闰法”按钮即可。

按程序以无中气置闰，则僖五年虽无闰余，其年有闰。与未加蔀首闰余一结果相同。乃因二者求积月差一，本仅月序不同，又以中气重排月序，无中气皆在辛巳朔之月，故最终结果相同。

## 张培瑜算法

|入章年|闰余|
|:---:|:---:|
|1|0|
|2|7|
|3|14|
|4|2|
|5|9|
|6|16|
|7|4|
|8|11|
|9|18|
|10|6|
|11|13|
|12|1|
|13|8|
|14|15|
|15|3|
|16|10|
|17|17|
|18|5|
|19|12|

依上四分历一章闰余表，[^4]闰余1之岁为入章第12年。张培瑜所用上元在顾观光上元后2880年，即1纪17蔀3章又11年，即入顾观光鲁历丁卯蔀第4章第12年，故有蔀首闰余1。2880年积日$2880\times365.25=1051920$，可被60整除，故其干支序及小余值与顾观光相同，区别仅在于入蔀与大余。故张培瑜说“两种复原方法都以庚子为上元，推算的朔闰也基本一致。”

依顾观光算法及上元，蔀首至朔同日，无余分，故张培瑜以为其“以闰余0之岁作蔀首”，[^5]顾观光称之为“鲁历章首虚置闰余1”。[^6]而依张培算法及上元，得蔀首朔在冬至前1日又521/940，即1/19月，故张培瑜称“我们是根据'鲁历不正，以闰余一之岁为蔀首'复原的。”[^7]

郜积意依顾观光算法，用张培瑜上元，推庄公廿六年（BC668）得“天正正月己亥朔，小余133”。[^8]以为张培瑜推春秋日食不合。然以此算法推僖五年天正朔得甲申，小余73，与张培瑜在《中国古代历法》中所述“鲁历正月壬子朔，小余51分”不合。[^9]。故张培瑜所用算法与顾观光不同。

按张培瑜认为“鲁历南至，又先周历四分日之三，而朔后此值（四分日之三）又九百四十分之五十一。”[^10]依上表，则鲁历冬至庚戌，小余16。正月朔后周历$\frac{3}{4}+\frac{51}{940}=\frac{756}{940}$日，即壬子朔，小余51。郜积意认为应作“朔后〔殷历〕九百四十分日之五十一”。[^11]二者表达不同，结果一致，因为周历天正气朔即先殷历四分之三日。

张培瑜未言明其算法，笔者推测，其闰余较顾观光多1，即每年天正气朔较顾观光多1/19月，若求积月时减去，即可得相同结果。

$ 入蔀积月\frac{闰余}{章岁}=入蔀年 \times \frac{章月}{章岁} -\frac{1}{19} $

$ 入蔀积日\frac{小余}{蔀月}=（入蔀积月 -\frac{1}{19}） \times 朔策 = \frac{（入蔀积月 -\frac{1}{19}） \times 蔀日}{蔀月}$

可见二者的区别在于，顾观光在求积月前加闰余1，此法在求积月后减闰余1。无论如何，张培瑜认为的鲁历是天正气朔后周历小余756，与郜积意认为的后殷历小余51相同。古六历虽上元、岁首之类有异，然皆可从某一部历法中加减小余差值得到另一部历法。此二者鲁历小余差值既同，所求结果也必然相同。

## BC1841年为近元的鲁历
以上，顾观光上元BC2763681，近元BC321。前一纪首为BC1841年。
张培瑜上元BC2760801，近元BC2001。

张培瑜在推算魏安釐王二十五年时又用鲁历近元BC1841年。上推606元，得上元BC2765201年，与顾观光适差两纪。入纪年既同，故所求结果也必然相同。以此算开元二年积年，得2761354，与《开元占经》积年数仅差一字，“五”误为“三”，较顾观光更为合理。顾观光未说明其所改上元理由，笔者推测《开元占经》中其余五历推春秋时历皆入人纪，若依BC1841为近元，则鲁历入天纪，上推两纪，则可得鲁历入人纪。但改字较多，实无必要。

也就是说，无论是BCBC2763681、BC2760801或BC2765201的上元，所推气朔都相同。气朔既同，依无中气法置闰，闰月也相同。郜积意认为张培瑜《中国先秦史历表·附表四》中春秋日食“不据上元积年2761514为算，乃据上元积年2761354推算”[^12]，实为误解，二者皆有可能。



[^1]: 顾观光《六历通考》，《中国科学技术典籍通汇·天文卷》，827页。
[^2]: 张培瑜等《中国古代历法》上，374页，中国科学技术出版社，2007年第一版。
[^3]: 顾观光《六历通考》，《中国科学技术典籍通汇·天文卷》，835页。
[^4]: 张培瑜等《中国古代历法》上，365页，中国科学技术出版社，2007年第一版。
[^5]: 张培瑜等《中国古代历法》上，375页，中国科学技术出版社，2007年第一版。
[^6]: 顾观光《六历通考》，《中国科学技术典籍通汇·天文卷》，835页。
[^7]: 张培瑜等《中国古代历法》上，375页，中国科学技术出版社，2007年第一版。
[^8]: 郜积意《经学与历学的贯通》，《学术月刊》第52卷，155页。
[^9]: 张培瑜等《中国古代历法》上，373页，中国科学技术出版社，2007年第一版。
[^10]:张培瑜等《中国古代历法》上，373页，中国科学技术出版社，2007年第一版。
[^11]: 郜积意《经学与历学的贯通》，《学术月刊》第52卷，156页。
[^12]: 郜积意《经学与历学的贯通》，《学术月刊》第52卷，155页。
